apiVersion: v1
kind: Service
metadata:
  name: mysql
  annotations:
    metallb.universe.tf/allow-shared-ip: minikube
  labels:
    run: mysql
spec:
  type: ClusterIP
  ports:
  - name: http
    protocol: TCP
    port: 3306
  selector:
    run: mysql
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mysql
  labels:
    run: mysql
spec:
  serviceName: mysql
  replicas: 1
  selector:
    matchLabels:
      run: mysql
    template:
      metadata:
        labels:
          run: mysql
      spec:
        containers:
        - name: mysql
          image: service_mysql
          imagePullPolicy: Never
          env:
          - name: DB_NAME
            valueFrom:
              secretKeyRef:
                name: db-id
                key: name
          - name: DB_USER
            valueFrom:
              secretKeyRef:
                name: db-id
                key: user
          - name: DB_PASSWORD
            valueFrom:
              secretKeyRef:
                name: db-id
                key: password
          - name: DB_HOST
            valueFrom:
              secretKeyRef:
                name: db-id
                key: host
          ports:
          - containerPort: 3306